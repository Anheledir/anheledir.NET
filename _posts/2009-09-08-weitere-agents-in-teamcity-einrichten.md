---
layout: post
title: Weitere Agents in Teamcity einrichten
date: 2009-09-08 11:14
author: Gordon Breuer
comments: true
categories: [Development, Werkzeugkiste]
---
<p><img style="border-right-width: 0px; margin: 5px 10px 0px 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="TeamCity" border="0" alt="TeamCity" align="left" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/TeamCity.gif" width="240" height="54" /> Ein häufig eingesetzt Programm für die “<b>Kontinuierliche Integration</b>” in der Softwareentwicklung ist sicherlich <a href="http://www.jetbrains.com/teamcity/index.html" target="_blank">TeamCity</a> der Firma <a href="http://www.jetbrains.com/index.html" target="_blank">Jetbrains</a>. Grundvoraussetzung ist dabei eine Versionsverwaltung. Auch habe ich vor einiger Zeit mal <a href="http://old.gordon-breuer.de/post/2008/11/19/Automatisches-Deployment-mit-Subversion.aspx">einen Weg beschrieben</a>, wie man beispielsweise nach jedem Hochladen von Änderungen das Projekt automatisch neu erstellen kann. Die dort beschriebene Methode hat allerdings einige Nachteile, beispielsweise muss man bei jedem Check-In warten bis der Build abgeschlossen wurde bevor man weiter arbeiten kann. Um diesen Prozess auszulagern setzt man normalerweise stattdessen unabhängige Programme ein. TeamCity ist ein solches Werkzeug und für Privatpersonen und kleine Teams kostenlos erhältlich. Vor allem die <strong>einfache Erstinstallation</strong> und <strong>Konfiguration</strong> des Servers machen es so beliebt (<em>wenn ein kleines Tutorial hierzu gewünscht ist hinterlasst einfach einen Kommentar hier unter dem Beitrag und ich schaue das ich eins vorbereite)</em>.</p>  <p>Ein weiterer großer Vorteil von TeamCity als “<em>Distributed Build Management and Continuous Integration Server</em>” sind neben vielen anderen Dingen die Möglichkeit mehr als einen so genannten<strong> Build-Agent</strong> einzusetzen. Denn der eigentliche Server ist für das Kompilieren von Projekten überhaupt <strong>nicht zuständig</strong>. Er stellt lediglich alle notwendigen Daten bereit und übergibt die Aufgabe dann an einen so genannten Agenten. Diese Agenten sind kleine Systemdienste auf <strong>Entwicklungs</strong>- oder <strong>Testrechnern</strong> und können somit ganz <strong>unterschiedliche Szenarien und Konfigurationen</strong> abdecken, beispielsweise das automatische Ausführen von Tests unter verschiedenen Betriebssystemen, Sprachversionen, älterer Hardware, …</p>  <p><img style="border-right-width: 0px; margin: 0px 0px 0px 10px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Aboutpixel.de - Serverschrank - (c) snygo" border="0" alt="Aboutpixel.de - Serverschrank - (c) snygo" align="right" src="http://old.gordon-breuer.de/wp-content/uploads/2009/09/Serverschrank%20-%20snygo.jpg" width="150" height="139" /> Standartmäßig wird bei der Installation von TeamCity bereits ein Agent auf dem selben Server mit installiert und eingerichtet, man kann jedoch auch weitere hinzufügen. In der kostenlosen Version von Teamcity sind bis zu <strong>3 autorisierte Agenten gleichzeitig</strong> möglich. Ich habe beispielsweise einen Agenten auf dem Server installiert, auf dem aber Visual Studio fehlt. Ohne weiteres ist dort also das Ausführen von Unit-Tests bspw. mit MS-Test nicht möglich. Ein zweiter Agent ist auf meiner Arbeitsstation im Büro installiert; hier habe ich nicht nur eine vollständige Entwicklungsumgebung sondern auch Zugriff auf das interne Netzwerk um beispielsweise Kundenwebs automatisch vom Agenten per Script zu veröffentlichen. Der letzte Agent ist auf meinem Rechner zu Hause unter Windows 7 64bit installiert, um auch Builds und Tests in einer 64-Bit Umgebung durchführen zu können.</p>  <p>Um einen Agenten mit dem TeamCity -Server zu verbinden muss dieser über eine IP und einen Port erreichbar sein. Doch zumindestens bei mir schlug die automatische Erkennung eben dieser IP-Adresse immer fehl, so dass der Agent sich nicht beim Server anmelden konnte. Das Problem tritt innerhalb des selben Netzwerkers vermutlich seltener auf, im aufgezeigten Szenario haben wir jedoch drei geographisch vollständig getrennte Netze, die über eine VPN-Verbindung miteinander vernetzt sind. Man muss also die <strong>automatische IP-Detektion</strong> des Agenten umgehen und ihm eine<strong> feste IP-Adresse</strong> zuweisen mit der er sich beim Server meldet und unter der er dann auch erreichbar ist. [more]</p>  <p><img style="border-right-width: 0px; margin: 0px 10px 0px 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="aboutpixel.de - IP - Christoph Ruhland" border="0" alt="aboutpixel.de - IP - Christoph Ruhland" align="left" src="http://old.gordon-breuer.de/wp-content/uploads/2009/09/IP%20%C2%A9%20Christoph%20Ruhland.jpg" width="100" height="150" /> Am einfachsten kann man das <strong>direkt bei der Installation</strong> des Agenten machen. Nach dem Kopieren aller notwendigen Dateien (<em>Bild 3</em>) erscheint eine Abfrage der Konfiguration (<em>Bild 4</em>). Hier klickt man auf den Button “<em>Add</em>” und erstellt eine neue Eigenschaft “<em>ownAddress</em>” mit der zu verwendenden IP-Adresse als Wert. Ansonsten findet man die Konfigurationsdatei auch unter “<em>&lt;BuildAgent Installation-Path&gt;confbuildAgent.properties</em>” und fügt dort entsprechend eine weitere Zeile hinzu, beispielsweise “<em>ownAddress=5.100.178.174</em>”. Der Agent erkennt <strong>automatisch</strong>, dass die Konfiguration geändert wurde und<strong> startet sich selbständig neu</strong>.</p>  <p>Für die Vernetzung der drei unterschiedlichen Netzwerke habe ich übrigens das <strong>kostenlose Programm</strong> “<em><a href="https://secure.logmein.com/DE/products/hamachi2/" target="_blank">Hamachi</a></em>” eingesetzt, welches über das Internet ein <strong>geschütztes VPN</strong> bereitstellt. In Unternehmen ist jedoch vor dem Einsatz eines solchen Programmes unbedingt zunächst <strong>Rücksprache mit dem Netzwerk- bzw. Systemadministrator</strong> zu halten ob die Installation gestattet wird. Immerhin öffnet man mit dem Programm bei unsachgemäßer Konfiguration ein unter Umständen ungeschütztes Tor in das Unternehmensnetzwerk! <em>Auch wenn zu diesem Tool ein kleines Tutorial erwünscht ist könnt ihr euch mit einem Kommentar hier melden und ich werde sehen was sich machen lässt.</em></p>  <h3>Bebilderte Installationsanleitung</h3>  <p><a href="http://static.gordon-breuer.de/img/cap1.png" rel="lightbox[TeamCity]"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Herunterladen der Installationsdatei vom Teamcity-Server" border="0" alt="Herunterladen der Installationsdatei vom Teamcity-Server" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/cap1_thumb.png" width="104" height="29" /></a> <a href="http://static.gordon-breuer.de/img/cap2.png" rel="lightbox[TeamCity]"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Auswählen der zu installierenden Komponenten, inklusive dem Windows-Service" border="0" alt="Auswählen der zu installierenden Komponenten, inklusive dem Windows-Service" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/cap2_thumb.png" width="104" height="77" /></a> <a href="http://static.gordon-breuer.de/img/cap3.png" rel="lightbox[TeamCity]"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Erforderliche Dateien werden kopiert" border="0" alt="Erforderliche Dateien werden kopiert" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/cap3_thumb.png" width="104" height="77" /></a> <a href="http://static.gordon-breuer.de/img/cap4.png" rel="lightbox[TeamCity]"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Dialog mit den Einstellungen für den Agenten" border="0" alt="Dialog mit den Einstellungen für den Agenten" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/cap4_thumb.png" width="104" height="76" /></a> <a href="http://static.gordon-breuer.de/img/cap5.png" rel="lightbox[TeamCity]"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Einstellen des zu verwendenden Benutzerkontos beim Starten des Services" border="0" alt="Einstellen des zu verwendenden Benutzerkontos beim Starten des Services" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/cap5_thumb.png" width="104" height="77" /></a> <a href="http://static.gordon-breuer.de/img/cap6.png" rel="lightbox[TeamCity]"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Abschluss der Installation und erster Start des Agenten" border="0" alt="Abschluss der Installation und erster Start des Agenten" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/cap6_thumb.png" width="104" height="77" /></a> <a href="http://static.gordon-breuer.de/img/cap7.png" rel="lightbox[TeamCity]"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Wurde die IP-Adresse des Agenten korrekt eingegeben erscheint dieser ab sofort auch in der Liste aller Agenten im Server und kann dort authorisiert werden" border="0" alt="Wurde die IP-Adresse des Agenten korrekt eingegeben erscheint dieser ab sofort auch in der Liste aller Agenten im Server und kann dort authorisiert werden" src="http://anheledirwp.blob.core.windows.net/wordpress/2009/09/cap7_thumb.png" width="104" height="39" /></a></p><div class="wlWriterHeaderFooter" style="text-align:left; margin:0px; padding:4px 4px 4px 4px;"><a href="http://dotnet-kicks.de/kick/?url=http://old.gordon-breuer.de/post/2009/09/08/Weitere-Agents-in-Teamcity-einrichten.aspx"><img src="http://dotnet-kicks.de/Services/Images/KickItImageGenerator.ashx?url=http://old.gordon-breuer.de/post/2009/09/08/Weitere-Agents-in-Teamcity-einrichten.aspx&amp;bgcolor=3169AD&amp;fgcolor=FFFFFF&amp;border=000000&amp;cbgcolor=D4E1ED&amp;cfgcolor=000000" alt="DotNetKicks-DE Image" border="0" /></a></div>
